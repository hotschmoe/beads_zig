Initialized beads workspace in .test_tmp/init_structure_1769998031315\.beads/
  Issue prefix: test
  Issues file: .test_tmp/init_structure_1769998031315\.beads/issues.jsonl
Initialized beads workspace in .test_tmp/init_already_1769998031323\.beads/
  Issue prefix: bd
  Issues file: .test_tmp/init_already_1769998031323\.beads/issues.jsonl
Initialized beads workspace in .test_tmp/init_prefix_1769998031325\.beads/
  Issue prefix: proj
  Issues file: .test_tmp/init_prefix_1769998031325\.beads/issues.jsonl
Initialized beads workspace in .test_tmp/init_metadata_1769998031328\.beads/
  Issue prefix: bd
  Issues file: .test_tmp/init_metadata_1769998031328\.beads/issues.jsonl
Initialized beads workspace in .test_tmp/init_gitignore_1769998031342\.beads/
  Issue prefix: bd
  Issues file: .test_tmp/init_gitignore_1769998031342\.beads/issues.jsonl
# beads_zig Storage Schema

Storage Type: JSONL (JSON Lines)

## Files

- `.beads/beads.jsonl` - Main issue storage (git-tracked)
- `.beads/beads.wal` - Write-ahead log (gitignored)
- `.beads/beads.lock` - Lock file for flock (gitignored)

## Issue (beads.jsonl)

One JSON object per line in the main JSONL file.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | string | yes | Issue ID (bd-XXXXX format) |
| content_hash | string | no | SHA256 hash for deduplication |
| title | string | yes | Issue title (1-500 chars) |
| description | string | no | Detailed description |
| design | string | no | Design notes |
| acceptance_criteria | string | no | Definition of done |
| notes | string | no | Additional notes |
| status | string | yes | open, in_progress, blocked, deferred, closed, tombstone, pinned |
| priority | number | yes | 0 (critical) to 4 (backlog) |
| issue_type | string | yes | task, bug, feature, epic, chore, docs, question |
| assignee | string | no | Assigned user |
| owner | string | no | Issue owner |
| created_at | string | yes | RFC3339 timestamp |
| created_by | string | no | Creator |
| updated_at | string | yes | RFC3339 timestamp |
| closed_at | string | no | RFC3339 timestamp when closed |
| close_reason | string | no | Reason for closing |
| due_at | string | no | RFC3339 due date |
| defer_until | string | no | RFC3339 defer date |
| estimated_minutes | number | no | Time estimate |
| external_ref | string | no | External tracker link |
| source_system | string | no | Import source |
| pinned | boolean | yes | High-priority display flag |
| is_template | boolean | yes | Template flag |
| labels | array | yes | String array of labels |
| dependencies | array | yes | Array of Dependency objects |
| comments | array | yes | Array of Comment objects |

## WAL Entry (beads.wal)

Write-ahead log for concurrent writes.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| op | string | add, update, close, reopen, delete, set_blocked, unset_blocked |
| ts | number | Unix timestamp for ordering |
| id | string | Issue ID |
| data | object | Full Issue object (for add/update) or null |

## Dependency

Embedded in Issue.dependencies array.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| issue_id | string | Dependent issue |
| depends_on_id | string | Blocker issue |
| dep_type | string | blocks, parent_child, waits_for, related, etc. |
| created_at | string | RFC3339 timestamp |
| created_by | string | Creator |
| metadata | string | JSON blob for extra data |
| thread_id | string | Optional thread reference |

## Comment

Embedded in Issue.comments array.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| id | number | Comment ID |
| issue_id | string | Parent issue ID |
| author | string | Comment author |
| body | string | Comment text |
| created_at | string | RFC3339 timestamp |
{"storage_type":"jsonl","files":{"main":"beads.jsonl","wal":"beads.wal","lock":"beads.lock"},"objects":[{"name":"Issue","obj_type":"entity","description":"Primary issue record stored in beads.jsonl"},{"name":"WalEntry","obj_type":"log","description":"WAL operation entry in beads.wal"},{"name":"Dependency","obj_type":"embedded","description":"Dependency relationship"},{"name":"Comment","obj_type":"embedded","description":"Issue comment"}]}
# bash completion for bz (beads_zig)
# Add to ~/.bashrc: source <(bz completions bash)

_bz_completions() {
    local cur prev words cword
    _init_completion || return

    local commands="init create q show update close reopen delete list ready blocked search stale count dep label comments history audit sync config info stats doctor orphans lint version schema completions"

    if [[ $cword -eq 1 ]]; then
        COMPREPLY=($(compgen -W "$commands" -- "$cur"))
        return
    fi

    case ${words[1]} in
        show|update|close|reopen|delete|comments|history)
            # Complete with issue IDs
            local ids=$(bz list --quiet 2>/dev/null)
            COMPREPLY=($(compgen -W "$ids" -- "$cur"))
            ;;
        dep)
            if [[ $cword -eq 2 ]]; then
                COMPREPLY=($(compgen -W "add remove list tree cycles" -- "$cur"))
            else
                local ids=$(bz list --quiet 2>/dev/null)
                COMPREPLY=($(compgen -W "$ids" -- "$cur"))
            fi
            ;;
        label)
            if [[ $cword -eq 2 ]]; then
                COMPREPLY=($(compgen -W "add remove list list-all" -- "$cur"))
            else
                local ids=$(bz list --quiet 2>/dev/null)
                COMPREPLY=($(compgen -W "$ids" -- "$cur"))
            fi
            ;;
        comments)
            if [[ $cword -eq 2 ]]; then
                COMPREPLY=($(compgen -W "add list" -- "$cur"))
            fi
            ;;
        config)
            if [[ $cword -eq 2 ]]; then
                COMPREPLY=($(compgen -W "get set list" -- "$cur"))
            fi
            ;;
        sync)
            COMPREPLY=($(compgen -W "--flush-only --import-only" -- "$cur"))
            ;;
        completions)
            COMPREPLY=($(compgen -W "bash zsh fish powershell" -- "$cur"))
            ;;
        create)
            COMPREPLY=($(compgen -W "--priority --type --assignee --label --dep" -- "$cur"))
            ;;
        list)
            COMPREPLY=($(compgen -W "--status --priority --type --assignee --label --all --limit --offset" -- "$cur"))
            ;;
        stale)
            COMPREPLY=($(compgen -W "--days" -- "$cur"))
            ;;
        count)
            COMPREPLY=($(compgen -W "--by" -- "$cur"))
            ;;
    esac
}

complete -F _bz_completions bz
#compdef bz
# zsh completion for bz (beads_zig)
# Add to ~/.zshrc: source <(bz completions zsh)

_bz() {
    local -a commands
    commands=(
        'init:Initialize beads workspace'
        'create:Create new issue'
        'q:Quick capture (create + print ID only)'
        'show:Display issue details'
        'update:Update issue fields'
        'close:Close an issue'
        'reopen:Reopen a closed issue'
        'delete:Soft delete (tombstone)'
        'list:List issues with filters'
        'ready:Show actionable issues (unblocked)'
        'blocked:Show blocked issues'
        'search:Full-text search'
        'stale:Find stale issues'
        'count:Count issues'
        'dep:Manage dependencies'
        'label:Manage labels'
        'comments:Manage comments'
        'history:Show issue history'
        'audit:View audit log'
        'sync:Sync with JSONL file'
        'config:Manage configuration'
        'info:Workspace info'
        'stats:Project statistics'
        'doctor:Run diagnostics'
        'orphans:Find orphaned issues'
        'lint:Validate database consistency'
        'version:Show version'
        'schema:View storage schema'
        'completions:Generate shell completions'
    )

    local -a global_opts
    global_opts=(
        '--json[Output in JSON format]'
        '--toon[Output in TOON format]'
        '-q[Quiet mode]'
        '--quiet[Quiet mode]'
        '-v[Verbose mode]'
        '--verbose[Verbose mode]'
        '--no-color[Disable colors]'
        '--data[Override .beads/ directory]:directory:_files -/'
    )

    _arguments -C \
        $global_opts \
        '1:command:->command' \
        '*::arg:->args'

    case $state in
        command)
            _describe 'command' commands
            ;;
        args)
            case ${words[1]} in
                show|update|close|reopen|delete)
                    _arguments '1:issue ID:($(bz list --quiet 2>/dev/null))'
                    ;;
                dep)
                    local -a dep_cmds
                    dep_cmds=('add:Add dependency' 'remove:Remove dependency' 'list:List dependencies' 'tree:Show dependency tree' 'cycles:Detect cycles')
                    _describe 'subcommand' dep_cmds
                    ;;
                label)
                    local -a label_cmds
                    label_cmds=('add:Add labels' 'remove:Remove labels' 'list:List labels' 'list-all:List all labels')
                    _describe 'subcommand' label_cmds
                    ;;
                completions)
                    local -a shells
                    shells=('bash' 'zsh' 'fish' 'powershell')
                    _describe 'shell' shells
                    ;;
            esac
            ;;
    esac
}

_bz
# fish completion for bz (beads_zig)
# Add to ~/.config/fish/completions/bz.fish

set -l commands init create q show update close reopen delete list ready blocked search stale count dep label comments history audit sync config info stats doctor orphans lint version schema completions

complete -c bz -f

# Main commands
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a init -d "Initialize workspace"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a create -d "Create issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a q -d "Quick capture"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a show -d "Show issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a update -d "Update issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a close -d "Close issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a reopen -d "Reopen issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a delete -d "Delete issue"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a list -d "List issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a ready -d "Show ready issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a blocked -d "Show blocked issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a search -d "Search issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a stale -d "Find stale issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a count -d "Count issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a dep -d "Manage dependencies"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a label -d "Manage labels"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a comments -d "Manage comments"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a history -d "Issue history"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a audit -d "Audit log"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a sync -d "Sync JSONL"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a config -d "Configuration"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a info -d "Workspace info"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a stats -d "Statistics"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a doctor -d "Diagnostics"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a orphans -d "Find orphaned issues"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a lint -d "Validate database"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a version -d "Show version"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a schema -d "Storage schema"
complete -c bz -n "not __fish_seen_subcommand_from $commands" -a completions -d "Shell completions"

# Global options
complete -c bz -l json -d "JSON output"
complete -c bz -l toon -d "TOON output"
complete -c bz -s q -l quiet -d "Quiet mode"
complete -c bz -s v -l verbose -d "Verbose mode"
complete -c bz -l no-color -d "Disable colors"
complete -c bz -l data -x -d "Override .beads/ directory"

# Subcommands
complete -c bz -n "__fish_seen_subcommand_from dep" -a "add remove list tree cycles"
complete -c bz -n "__fish_seen_subcommand_from label" -a "add remove list list-all"
complete -c bz -n "__fish_seen_subcommand_from comments" -a "add list"
complete -c bz -n "__fish_seen_subcommand_from config" -a "get set list"
complete -c bz -n "__fish_seen_subcommand_from completions" -a "bash zsh fish powershell"
# PowerShell completion for bz (beads_zig)
# Add to $PROFILE: . (bz completions powershell)

Register-ArgumentCompleter -Native -CommandName bz -ScriptBlock {
    param($wordToComplete, $commandAst, $cursorPosition)

    $commands = @(
        @{Name='init'; Description='Initialize workspace'}
        @{Name='create'; Description='Create issue'}
        @{Name='q'; Description='Quick capture'}
        @{Name='show'; Description='Show issue'}
        @{Name='update'; Description='Update issue'}
        @{Name='close'; Description='Close issue'}
        @{Name='reopen'; Description='Reopen issue'}
        @{Name='delete'; Description='Delete issue'}
        @{Name='list'; Description='List issues'}
        @{Name='ready'; Description='Show ready issues'}
        @{Name='blocked'; Description='Show blocked issues'}
        @{Name='search'; Description='Search issues'}
        @{Name='stale'; Description='Find stale issues'}
        @{Name='count'; Description='Count issues'}
        @{Name='dep'; Description='Manage dependencies'}
        @{Name='label'; Description='Manage labels'}
        @{Name='comments'; Description='Manage comments'}
        @{Name='history'; Description='Issue history'}
        @{Name='audit'; Description='Audit log'}
        @{Name='sync'; Description='Sync JSONL'}
        @{Name='config'; Description='Configuration'}
        @{Name='info'; Description='Workspace info'}
        @{Name='stats'; Description='Statistics'}
        @{Name='doctor'; Description='Diagnostics'}
        @{Name='orphans'; Description='Find orphaned issues'}
        @{Name='lint'; Description='Validate database'}
        @{Name='version'; Description='Show version'}
        @{Name='schema'; Description='Storage schema'}
        @{Name='completions'; Description='Shell completions'}
    )

    $commands | Where-Object { $_.Name -like "$wordToComplete*" } | ForEach-Object {
        [System.Management.Automation.CompletionResult]::new($_.Name, $_.Name, 'ParameterValue', $_.Description)
    }
}
